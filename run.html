


<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
    <title>Running REEFFIT &mdash; REEFFIT0.6.2 : RNA Ensemble Extraction From Footprinting Insights Technique | RiboKit</title>
    

    
      <link rel="shortcut icon" href="_static/ribokit.gif"/>
    

    <link rel="stylesheet" href="_static/css/styles.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/github-dark.css" type="text/css" />

    
      
    

    
    
      <link rel="top" title="REEFFIT0.6.2 : RNA Ensemble Extraction From Footprinting Insights Technique" href="index.html"/>
          <link rel="next" title="LICENSE" href="license.html"/>
          <link rel="prev" title="Installation" href="install.html"/> 

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-36037648-4', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <header>
    <h1>
        <a href="/">RiboKit</a> 
        
        : <a href="index.html">REEFFIT</a>
        
    </h1>
    <p>RNA Ensemble Extraction From Footprinting Insights Technique</p>
</header>
    <div id="banner">
  <div class="banner-inner">
    <span id="logo"><span class="octicon octicon-mark-github"></span></span>

    
      <a href="https://github.com/DasLab/REEFFIT" target="_blank" class="button fork"><strong>View On GitHub</strong></a>
    

    
  <form id="rtd-search-form" class="search-form" action="search.html" method="get">
    <input type="text" name="q" class="search-box" placeholder="Search for Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>

    
      
      
        <div class="version"><span>0.6.2</span></div>
      
    

    
      <div class="downloads">
        <span style="text-transform: none; font-size: 120%;"><u>run</u></span>
        <ul>
          
            <li><a href="index.html" class="button">&#x21E7;</a></li>
          
          
            <li><a href="install.html" class="button">&#x21E6;</a></li>
          
          
            <li><a href="license.html" class="button">&#x21E8;</a></li>
          
        </ul>
      </div>
  
  </div>
</div>


    <div class="wrapper">
      <nav>
    <ul style="margin-bottom:0;">
        <li class="tag-h1"><a href="index.html">REEFFIT Documentation</a></li>
    </ul>
    
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="technical.html">Technical Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running REEFFIT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-form">General Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-structural-ensemble">Obtaining Structural Ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ensemble-fitting-options">Ensemble Fitting Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-bootstrap">Preparing Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="#executing-bootstrap-and-compiling-results">Executing Bootstrap and Compiling Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-pdf-report">Generating PDF Report</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">LICENSE</a></li>
</ul>

        
    
</nav>
      <section>
      
  <div class="section" id="running-reeffit">
<h1>Running REEFFIT<a class="headerlink" href="#running-reeffit" title="Permalink to this headline">¶</a></h1>
<p>Almost all of <strong>REEFFIT</strong>'s functionality is accessed through the <code class="docutils literal"><span class="pre">reeffit</span></code> command, located in the <code class="docutils literal"><span class="pre">REEFFIT_HOME/bin</span></code> directory that was added to the <code class="docutils literal"><span class="pre">PATH</span></code> variable during installation.</p>
<p>There are four steps that are usually performed in a REEFFIT analysis, all of which are accessed through the <code class="docutils literal"><span class="pre">reeffit</span></code> command:</p>
<blockquote>
<div><ul class="simple">
<li>Obtaining a secondary structure ensemble</li>
<li>Preparing cross-validation or bootstrapping shell files</li>
<li>Executing the shell files</li>
<li>Compiling the results.</li>
</ul>
</div></blockquote>
<p>The following subsections explain how to run each.</p>
<hr class="docutils" />
<div class="section" id="general-form">
<h2>General Form<a class="headerlink" href="#general-form" title="Permalink to this headline">¶</a></h2>
<p>In each of the following analyses, the <code class="docutils literal"><span class="pre">reeffit</span></code> command is used in various ways. REEFFIT's main input is an RDAT file containing the data and details of the chemical mapping experiment.
Besides this, the only other necessary option is the output directory. The general form of the <code class="docutils literal"><span class="pre">reeffit</span></code> command is:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>reeffit RDAT_FILE OUTPUT_DIR <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p>The options given to REEFFIT will dictate its behavior.</p>
</div>
<hr class="docutils" />
<div class="section" id="obtaining-structural-ensemble">
<h2>Obtaining Structural Ensemble<a class="headerlink" href="#obtaining-structural-ensemble" title="Permalink to this headline">¶</a></h2>
<p>If a hypothesized secondary structure ensemble is not available, <strong>REEFFIT</strong> can estimate it using one of several methods:</p>
<ul class="simple">
<li><strong>Sampling of the suboptimal ensemble for all sequences</strong> (option <code class="docutils literal"><span class="pre">--modelselect=sample</span></code>):</li>
</ul>
<p>Up to 200 suboptimal structures that lie in at most 5% distance to the minimum free energy secondary structure are sampled for each sequence in the ensemble. The full resulting set of structures (usually on the order of 200 to 1000 for RNAs of 100 to 200 nucleotides in length), located in <code class="docutils literal"><span class="pre">OUTPUT_DIR/all_structures.txt</span></code> are used for subsequent analyses.</p>
<ul class="simple">
<li><strong>Selection of a small number of structures in the suboptimal ensemble that best agree with the data a priori</strong> (option <code class="docutils literal"><span class="pre">modelselect=heuristic</span></code>):</li>
</ul>
<p>The same procedure as in the point above is used to obtain a large number of suboptimal structures. These are then clustered into a small number of clusters (calculated by maximizing the Calinksi-Barabasz index) and representatives for each cluster are chosen by scoring them against each chemical mapping profile in the data using 1-dimensional mapping secondary struture directed modeling. Additional high-scoring structures are added if they decrease the AIC information score after a few EM iterations.</p>
<p>&lt;br/&gt;</p>
<p>The recomended method to obtain the structural ensemble is the first one: using all the structures sampled. We have observed that this captures most of the data better and can be properly regularized with several priors to account for the large number of variables to fit (see below).
Therefore, to obtain the structural ensemble, the reeffit command would be:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>reeffit RDAT_FILE OUTPUT_DIR --modelselect<span class="o">=</span>sample
</pre></div>
</div>
</div>
<div class="section" id="ensemble-fitting-options">
<h2>Ensemble Fitting Options<a class="headerlink" href="#ensemble-fitting-options" title="Permalink to this headline">¶</a></h2>
<p>There are several options that affect the way <strong>REEFFIT</strong> performs the fit to the data. The most important ones to consider are the ones below:</p>
<ul class="simple">
<li><strong>Number of parallel jobs</strong> (option <code class="docutils literal"><span class="pre">--njobs</span></code>):</li>
</ul>
<p>Some of <strong>REEFFIT</strong>'s calculations can be performed quickly in parallelized form. This option can specify the number of jobs to split the calculations into.</p>
<ul class="simple">
<li><strong>Number of EM iterations</strong> (option <code class="docutils literal"><span class="pre">--refineiter</span></code>):</li>
</ul>
<p>Number of maximum EM iterations to perform. The default is 10.</p>
<ul class="simple">
<li><strong>Mode of inference for the E-step</strong> (option <code class="docutils literal"><span class="pre">--softem</span></code> to use soft EM (MCMC inference) instead of the default hard EM (MAP estimation) mode):</li>
</ul>
<p>The most rigorous way to run <strong>REEFFIT</strong> is using the <code class="docutils literal"><span class="pre">--softem</span></code>  option to perform MCMC inference at each E-step in the calculation (set the number of simulation steps to take with the <code class="docutils literal"><span class="pre">--nsim</span></code> option, which defaults to 1000). This however, is terribly costly computationally and can come at an expense of other important downstream analyses, like bootstrapping. In our experience, performing hard EM does not alter the results terribly and can therefore be safely used.</p>
<ul class="simple">
<li><strong>Motif decomposition</strong> (option <code class="docutils literal"><span class="pre">--decompose</span></code>, default is no decomposition):</li>
</ul>
<p>When the ensemble to fit is large, it may be useful to decompose the structures into overlapping secondary structure motifs, forcing all motifs that are structurally the same to have the same reactivity profile. This greatly reduces the number of variables in the model and speeds up the computation. Note that this is not activated by default.</p>
<ul class="simple">
<li><strong>Data normalization</strong> (option <code class="docutils literal"><span class="pre">--boxnormalize</span></code>):</li>
</ul>
<p>When handling capillary electrophoresis chemical mapping data that has not been rigorously normalize (through, for example, a dilution series), it is recommended to normalize the data to conform to the prior reactivities coded into <strong>REEFFIT</strong>. This option should box the data into values from 0 to 2 and get rid of outliers. Note that if normalization has been previously peformed on the dataset, this additional normalization will produce large artifacts and will essentially &quot;flatten&quot; the data.</p>
</div>
<hr class="docutils" />
<div class="section" id="preparing-bootstrap">
<h2>Preparing Bootstrap<a class="headerlink" href="#preparing-bootstrap" title="Permalink to this headline">¶</a></h2>
<p>In order to robustly estimate population fraction errors, we perform boostrapping. Because bootstrapping is computationally expensive, we recommend using the <code class="docutils literal"><span class="pre">reeffit</span></code> command to prepare shell &quot;worker&quot; scripts that will perform the bootstrapping in parallel.</p>
<p>To achieve this, we use the <code class="docutils literal"><span class="pre">--preparebootstrap</span></code> option. To set up the scripts, we have to divide the number of bootstraps into the number of worker scripts that are going to be running simultaneously using the <code class="docutils literal"><span class="pre">--nworkers</span></code> and <code class="docutils literal"><span class="pre">--ntasks</span></code> options. For example, to set up 100 bootstraps for 5 workers, we would use the options <code class="docutils literal"><span class="pre">--nworkers=5</span> <span class="pre">--ntasks=20</span></code>.</p>
<p>It is important to note that every option passed to the command will be passed to the worker scripts.</p>
<p>Assuming that we have the structural ensemble in <code class="docutils literal"><span class="pre">OUTPUT_DIR/all_structures.txt</span></code> and we want to activate motif decomposition, the REEFFIT command for this task would be:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>reeffit RDAT_FILE OUTPUT_DIR --structfile<span class="o">=</span>OUTPUT_DIR/all_structures.txt --decompose --preparebootstrap --nworkers<span class="o">=</span><span class="m">5</span> --ntasks<span class="o">=</span>20
</pre></div>
</div>
<p>This will write several <code class="docutils literal"><span class="pre">bootstrap_workerN.sh</span></code> scripts to the output directory, as well as a <code class="docutils literal"><span class="pre">master_bootstrap_script.sh</span></code></p>
</div>
<hr class="docutils" />
<div class="section" id="executing-bootstrap-and-compiling-results">
<h2>Executing Bootstrap and Compiling Results<a class="headerlink" href="#executing-bootstrap-and-compiling-results" title="Permalink to this headline">¶</a></h2>
<p>Once the bootstrapping files are set up, we can execute them and compile the results using the master script.</p>
<p>To execute the bootstrap workers prepared in the section above, execute the generated master script:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sh OUTPUT_DIR/master_bootstrap_script.sh execute
</pre></div>
</div>
<p>All workers will then execute in parallel and store their results in <code class="docutils literal"><span class="pre">OUTPUT_DIR/bootN</span></code> directories.</p>
<p>After the workers are done, you can compile their results using the master script as well:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sh OUTPUT_DIR/master_bootstrap_script.sh compile
</pre></div>
</div>
<p>This will take some time, since it will do a <strong>REEFFIT</strong> fit will the full data in addition to compile the bootstrapping results.</p>
</div>
<hr class="docutils" />
<div class="section" id="generating-pdf-report">
<h2>Generating PDF Report<a class="headerlink" href="#generating-pdf-report" title="Permalink to this headline">¶</a></h2>
<p>Optionally, REEFFIT can produce a PDF report of the bootstrap results. This is achieved with the <code class="docutils literal"><span class="pre">reeffit_report</span></code> command, which is added to your PATH variable during installation:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>reeffit_report OUTPUT_DIR NAME PREFIX
</pre></div>
</div>
<p>Here, the <code class="docutils literal"><span class="pre">NAME</span></code> option is just to give a name to output structures in the report. The <code class="docutils literal"><span class="pre">PREFIX</span></code> option specifies which result files <strong>REEFFIT</strong> will use to generate the report. For example, all result files in the bootstrap analysis by default start with the bootstrap prefix. Therefore, to generate a report using the bootstrap results, <code class="docutils literal"><span class="pre">PREFIX</span></code> would be set to bootstrap.</p>
</div>
</div>


      </section>
    </div>

    <p class="wrapper">
      <small>Built with</small>
      <a href="http://sphinx-doc.org/" target="_blank">Sphinx</a>
      <small>using a</small>
      <a href="https://github.com/t47io/ribokit-Sphinx-theme" target="_blank">RiboKit Theme</a>
      <small>. Hosted on</small> GitHub Pages.
    </p>

    <p class="wrapper">
      <small>
        &copy; Copyright 2013-2016 Pablo Cordero G., Leland Stanford Junior University. All Rights Reserved.
      </small>
    </p>

    <p class="wrapper">
      
      <small>Last updated on</small> May 13, 2016.
      
    </p>

    <footer>
  <p style="margin:0;">
      <small>Project maintained by</small>
      <br/>
      <a href="https://github.com/DasLab"><b>Das Lab</b></a>&nbsp;
      
        <br/>
        <small>Page created by</small>
        <br/>
        <span style="color: #39c;"><i>Siqi Tian</i></span>&nbsp;
      
  </p>
</footer>

    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'0.6.2',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true
          };
      </script>
        
        
        
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        
        
          <script type="text/javascript" src="_static/doctools.js"></script>
        
        
          <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    

    <script type="text/javascript" src="_static/js/main.js"></script>
    <script type="text/javascript" src="_static/js/theme.js"></script>

     
  </body>
</html>